# 占位符系统使用指南

本文档将详细介绍如何使用本插件提供的占位符（Placeholder）及其强大的参数系统。

## 目录
1.  [基础用法](#1-基础用法)
2.  [参数系统](#2-参数系统)
    -   [向占位符传递参数](#21-向占位符传递参数)
    -   [格式化参数](#22-格式化参数)
        -   [数值精度 (`precision`)](#221-数值精度-precision)
        -   [条件输出 (`map`)](#222-条件输出-map)
        -   [布尔值映射 (`bool_map`)](#223-布尔值映射-bool_map)
        -   [字符替换 (`char_map`)](#224-字符替换-char_map)
        -   [正则表达式替换 (`regex_map`)](#225-正则表达式替换-regex_map)
        -   [颜色格式化](#226-颜色格式化)
3.  [综合示例](#3-综合示例)

---

## 1. 基础用法

占位符是用于动态显示信息的特殊字符串。它们可以被系统自动替换为相应的值。

**语法格式:**

系统支持两种格式的占位符：

-   `{placeholder_name}`
-   `%placeholder_name%`

**示例:**

假设我们有一个显示玩家名字的占位符 `player_name`。

-   输入: `你好, {player_name}!`
-   输出: `你好, Steve!`

---

## 2. 参数系统

为了提供更灵活的输出，占位符系统支持强大的参数功能。参数紧跟在占位符名称后面，用冒号 `:` 分隔。多个参数之间用逗号 `,` 分隔。

**通用语法:**

`{placeholder_name:parameter1,parameter2,...}`

参数分为两类：
1.  **占位符自身参数**: 由占位符内部逻辑处理的参数。
2.  **格式化参数**: 系统内置的，用于对占位符的输出结果进行格式化的参数。

系统会自动区分这两类参数。

### 2.1. 向占位符传递原生参数

如果一个占位符被设计为可以接收原生参数，你可以直接将参数跟在后面。这些参数会直接传递给占位符的 `evaluateWithArgs` 方法。

**示例:**

假设有一个 `player_money` 占位符，它可以接收一个参数来查询不同类型的货币。

-   输入: `{player_money:gold}`
-   输出: `100` (假设玩家有 100 金币)

-   输入: `{player_money:silver}`
-   输出: `500` (假设玩家有 500 银币)

这里的 `gold` 和 `silver` 就是传递给 `player_money` 占位符的原生参数。

### 2.2. 格式化参数

格式化参数是系统内置的，它们以特定的关键字开头（如 `precision=`、`map=`），用于对占位符返回的 **原始值** 进行处理和美化。

#### 2.2.1. 数值精度 (`precision`)

用于控制数值类型输出的小数位数。

-   **语法**: `precision=<小数位数>`
-   **适用**: 当占位符返回的是数字时。

**示例:**

假设 `player_pos_x` 返回玩家的 X 坐标 `123.45678`。

-   输入: `{player_pos_x:precision=2}`
-   输出: `123.46`

-   输入: `{player_pos_x:precision=0}`
-   输出: `123`

#### 2.2.2. 条件输出 (`map`)

根据占位符返回的 **数值**，按照预设的条件规则，输出不同的文本。

-   **语法**: `map=<规则1>;<规则2>;...;<默认值>`
-   **规则格式**: `<操作符><阈值>:<输出文本>`
-   **支持的操作符**: `>` (大于), `<` (小于), `=` (等于), `>=` (大于等于), `<=` (小于等于), `!=` (不等于)。
-   **特殊标记**: 在输出文本中，可以使用 `{value}` 来代表占位符的原始值。

**示例:**

假设 `server_tps` 返回服务器的 TPS 值。

-   输入: `{server_tps:map=>18:§a优秀;>15:§e良好;§c较差}`
-   输出:
    -   如果 TPS 为 `19.5`，输出: `§a优秀`
    -   如果 TPS 为 `16.2`，输出: `§e良好`
    -   如果 TPS 为 `10.1`，输出: `§c较差`

**带 `{value}` 的示例:**

-   输入: `{server_tps:precision=1,map=>18:§a优秀 ({value});>15:§e良好 ({value});§c较差 ({value})}`
-   输出 (TPS 为 19.5): `§a优秀 (19.5)`

#### 2.2.3. 布尔值映射 (`bool_map`)

用于将占位符返回的特定字符串（通常是 "true" / "false"）映射为自定义的文本。

-   **语法**: `bool_map=<映射1>;<映射2>;...`
-   **映射格式**: `<原始值>:<目标文本>`

**示例:**

假设 `player_is_flying` 在玩家飞行时返回 `true`，否则返回 `false`。

-   输入: `{player_is_flying:bool_map=true:§a飞行中;false:§c地面上}`
-   输出:
    -   如果玩家在飞行，输出: `§a飞行中`
    -   如果玩家在地面，输出: `§c地面上`

#### 2.2.4. 字符替换 (`char_map`)

用于对占位符返回的字符串中的特定字符进行替换。

-   **语法**: `char_map=<替换1>;<替换2>;...`
-   **替换格式**: `<原始字符>:<目标字符>`

**示例:**

假设 `player_name` 返回玩家名字 "Player-123"。

-   输入: `{player_name:char_map=P:p;-:_;1:一}`
-   输出: `player_一23`

#### 2.2.5. 正则表达式替换 (`regex_map`)

用于对占位符返回的字符串进行正则表达式查找和替换。

-   **语法**: `regex_map=<正则表达式1>:<替换字符串1>;<正则表达式2>:<替换字符串2>;...`
-   **替换格式**: `<正则表达式>:<替换字符串>`
-   **注意**: 替换字符串中可以使用 `$1`, `$2` 等来引用正则表达式的捕获组。

**示例:**

假设 `player_name` 返回玩家名字 "Player_Name_123"。

-   输入: `{player_name:regex_map=([A-Z]):$1;(_):-}`
-   输出: `Player-Name-123` (将大写字母转换为自身，下划线替换为连字符)

-   输入: `{player_name:regex_map=^Player_(\w+)_(\d+)$:User-$1-$2}`
-   输出: `User-Name-123` (如果匹配整个字符串，则进行重组)

#### 2.2.6. 颜色格式化

根据占位符返回的 **数值**，应用不同的颜色代码。

##### a) 单一颜色

最简单的用法是直接提供一个颜色代码。

-   **语法**: `:<颜色代码>`

**示例:**

-   输入: `{player_name:§e}`
-   输出: `§eSteve`

##### b) 基于阈值的颜色

可以设置多个阈值，让数值在不同范围显示不同颜色。

-   **语法**: `:<阈值1>,<颜色1>,<阈值2>,<颜色2>,...,<默认颜色>`
-   **逻辑**: 系统会从左到右检查，当数值 **小于** 第一个阈值时，应用其对应的颜色，否则继续检查下一个，直到最后使用默认颜色。

**示例:**

假设 `player_ping` 返回玩家延迟。

-   输入: `{player_ping:map=50,§a,100,§e,§c}`
-   输出:
    -   Ping 为 `30` (小于50)，输出: `§a30`
    -   Ping 为 `80` (小于100)，输出: `§e80`
    -   Ping 为 `150`，输出: `§c150`

##### c) 自定义颜色格式 (`color_format`)

默认情况下，颜色代码会直接加在值的前面。你可以通过 `color_format` 自定义最终的输出格式。

-   **语法**: `color_format=<格式字符串>`
-   **特殊标记**:
    -   `{color}`: 将被替换为计算出的颜色代码。
    -   `{value}`: 将被替换为占位符的原始值。

**示例:**

-   输入: `{player_ping:map=50,§a,100,§e,§c,color_format=§7[§r{color}{value}§7]}`
-   输出 (Ping 为 30): `§7[§r§a30§7]`

---

## 3. 综合示例

参数可以组合使用，用逗号 `,` 分隔。系统会先处理占位符自身参数，然后对结果进行格式化。

**示例:**

假设有一个 `player_exp_percent` 占位符，返回玩家当前等级的经验百分比（0-100）。我们希望：
1.  保留一位小数。
2.  根据百分比显示不同状态和颜色。

-   **输入:**
    ```
    {player_exp_percent:precision=1,map=>80:§a冲刺;>50:§e努力;§c加油,color_format={color}{value}%,50,§c,80,§e,§a}
    ```

-   **分析:**
    1.  `precision=1`: 将经验百分比格式化为一位小数。
    2.  `map=>80:§a冲刺;...`: 根据数值添加 "冲刺"、"努力"、"加油" 等前缀。
    3.  `color_format=...`: 根据数值范围（0-50, 50-80, 80+）应用不同颜色，并在最后添加一个百分号 `%`。

-   **输出:**
    -   如果经验为 `95.46`，输出: `§a冲刺95.5%`
    -   如果经验为 `62.12`，输出: `§e努力62.1%`
    -   如果经验为 `30.8`，输出: `§c加油30.8%`
